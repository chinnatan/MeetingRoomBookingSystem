<template>
  <div>
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <svg
            id="floor1"
            width="100%"
            height="100%"
            x="605"
            y="270"
            overflow="visible"
            xmlns="http://www.w3.org/2000/svg"
            xmlns:se="http://svg-edit.googlecode.com"
            xmlns:xlink="http://www.w3.org/1999/xlink"
            viewBox="0 0 600 440"
          >
            <!-- Created with SVG-edit - http://svg-edit.googlecode.com/ -->
            <g style="pointer-events:all" stroke="none" fill="#000000" stroke-width="1px">
              <title
                style="pointer-events:inherit"
                stroke="none"
                fill="#000000"
                stroke-width="1px"
              >Floor 1</title>
              <rect
                fill="#aaffff"
                stroke="#000000"
                stroke-width="0px"
                x="138"
                y="137"
                width="92"
                height="92"
                id="floor_1_service"
                fill-opacity="1"
                stroke-opacity="1"
              />
              <rect
                fill="#bfbfbf"
                stroke="#000000"
                stroke-width="0px"
                x="138"
                y="237"
                width="92"
                height="92"
                id="floor_1_m04"
                fill-opacity="1"
                stroke-opacity="1"
                v-on:click="selectRoom(txtFloor[4].id, txtFloor[4].name, txtFloor[4].size, txtFloor[4].floor, txtFloor[4].pathImg, txtFloor[4].active)"
              />
              <rect
                fill="#bfbfbf"
                stroke="#000000"
                stroke-width="0px"
                x="138"
                y="337"
                width="92"
                height="92"
                id="floor_1_m03"
                fill-opacity="1"
                stroke-opacity="1"
                v-on:click="selectRoom(txtFloor[3].id, txtFloor[3].name, txtFloor[3].size, txtFloor[3].floor, txtFloor[3].pathImg, txtFloor[3].active)"
              />
              <rect
                fill="#bfbfbf"
                stroke="#000000"
                stroke-width="0px"
                x="437"
                y="137"
                width="92"
                height="92"
                id="floor_1_m23"
                fill-opacity="1"
                stroke-opacity="1"
                v-on:click="selectRoom(txtFloor[13].id, txtFloor[13].name, txtFloor[13].size, txtFloor[13].floor, txtFloor[13].pathImg, txtFloor[13].active)"
              />
              <rect
                fill="#bfbfbf"
                stroke="#000000"
                stroke-width="0px"
                x="437"
                y="237"
                width="92"
                height="92"
                id="floor_1_m22"
                fill-opacity="1"
                stroke-opacity="1"
                v-on:click="selectRoom(txtFloor[12].id, txtFloor[12].name, txtFloor[12].size, txtFloor[12].floor, txtFloor[12].pathImg, txtFloor[12].active)"
              />
              <rect
                fill="#bfbfbf"
                stroke="#000000"
                stroke-width="0px"
                x="437"
                y="337"
                width="92"
                height="92"
                id="floor_1_m21"
                fill-opacity="1"
                stroke-opacity="1"
                v-on:click="selectRoom(txtFloor[11].id, txtFloor[11].name, txtFloor[11].size, txtFloor[11].floor, txtFloor[11].pathImg, txtFloor[11].active)"
              />
              <rect
                fill="#bfbfbf"
                stroke="#000000"
                stroke-width="0px"
                x="290"
                y="250"
                width="45"
                height="45"
                fill-opacity="1"
                stroke-opacity="1"
                id="floor_1_m14"
                v-on:click="selectRoom(txtFloor[7].id, txtFloor[7].name, txtFloor[7].size, txtFloor[7].floor, txtFloor[7].pathImg, txtFloor[7].active)"
              />
              <rect
                fill="#bfbfbf"
                stroke="#000000"
                stroke-width="0px"
                x="342"
                y="250"
                width="45"
                height="45"
                fill-opacity="1"
                stroke-opacity="1"
                id="floor_1_m18"
                v-on:click="selectRoom(txtFloor[10].id, txtFloor[10].name, txtFloor[10].size, txtFloor[10].floor, txtFloor[10].pathImg, txtFloor[10].active)"
              />
              <rect
                fill="#bfbfbf"
                stroke="#000000"
                stroke-width="0px"
                x="290"
                y="300"
                width="45"
                height="45"
                fill-opacity="1"
                stroke-opacity="1"
                id="floor_1_m13"
                v-on:click="selectRoom(txtFloor[6].id, txtFloor[6].name, txtFloor[6].size, txtFloor[6].floor, txtFloor[6].pathImg, txtFloor[6].active)"
              />
              <rect
                fill="#bfbfbf"
                stroke="#000000"
                stroke-width="0px"
                x="342"
                y="300"
                width="45"
                height="45"
                fill-opacity="1"
                stroke-opacity="1"
                id="floor_1_m17"
                v-on:click="selectRoom(txtFloor[9].id, txtFloor[9].name, txtFloor[9].size, txtFloor[9].floor, txtFloor[9].pathImg, txtFloor[9].active)"
              />
              <rect
                fill="#bfbfbf"
                stroke="#000000"
                stroke-width="0px"
                x="290"
                y="350"
                width="45"
                height="45"
                fill-opacity="1"
                stroke-opacity="1"
                id="floor_1_m12"
                v-on:click="selectRoom(txtFloor[5].id, txtFloor[5].name, txtFloor[5].size, txtFloor[5].floor, txtFloor[5].pathImg, txtFloor[5].active)"
              />
              <rect
                fill="#bfbfbf"
                stroke="#000000"
                stroke-width="0px"
                x="342"
                y="350"
                width="45"
                height="45"
                fill-opacity="1"
                stroke-opacity="1"
                id="floor_1_m16"
                v-on:click="selectRoom(txtFloor[8].id, txtFloor[8].name, txtFloor[8].size, txtFloor[8].floor, txtFloor[8].pathImg, txtFloor[8].active)"
              />
              <rect
                fill="#bfbfbf"
                stroke="#000000"
                stroke-width="0px"
                x="138"
                y="37"
                width="92"
                height="92"
                fill-opacity="1"
                stroke-opacity="1"
                id="floor_1_111"
                v-on:click="selectRoom(txtFloor[1].id, txtFloor[1].name, txtFloor[1].size, txtFloor[1].floor, txtFloor[1].pathImg, txtFloor[1].active)"
              />
              <rect
                fill="#bfbfbf"
                stroke="#000000"
                stroke-width="0px"
                x="37"
                y="37"
                width="92"
                height="92"
                fill-opacity="1"
                stroke-opacity="1"
                id="floor_1_auditorium"
                v-on:click="selectRoom(txtFloor[0].id, txtFloor[0].name, txtFloor[0].size, txtFloor[0].floor, txtFloor[0].pathImg, txtFloor[0].active)"
              />
              <text
                fill="#000000"
                stroke="#000000"
                stroke-width="0px"
                stroke-dasharray="null"
                stroke-linejoin="null"
                stroke-linecap="null"
                x="184"
                y="220"
                id="txt_service"
                text-anchor="middle"
                xml:space="preserve"
                fill-opacity="1"
                stroke-opacity="1"
                v-if="txtFloors"
                v-text="txtFloor[2].name"
              />
              <text
                fill="#000000"
                stroke="#000000"
                stroke-width="0px"
                stroke-dasharray="null"
                stroke-linejoin="null"
                stroke-linecap="null"
                x="184"
                y="320"
                text-anchor="middle"
                xml:space="preserve"
                fill-opacity="1"
                stroke-opacity="1"
                id="txt_m04"
                v-if="txtFloors"
                v-text="txtFloor[4].name"
              />
              <text
                fill="#000000"
                stroke="#000000"
                stroke-width="0px"
                stroke-dasharray="null"
                stroke-linejoin="null"
                stroke-linecap="null"
                x="184"
                y="420"
                text-anchor="middle"
                xml:space="preserve"
                fill-opacity="1"
                stroke-opacity="1"
                id="txt_m03"
                v-if="txtFloors"
                v-text="txtFloor[3].name"
              />
              <text
                fill="#000000"
                stroke="#000000"
                stroke-width="0px"
                stroke-dasharray="null"
                stroke-linejoin="null"
                stroke-linecap="null"
                x="485"
                y="220"
                text-anchor="middle"
                xml:space="preserve"
                fill-opacity="1"
                stroke-opacity="1"
                id="txt_m23"
                v-if="txtFloors"
                v-text="txtFloor[13].name"
              />
              <text
                fill="#000000"
                stroke="#000000"
                stroke-width="0px"
                stroke-dasharray="null"
                stroke-linejoin="null"
                stroke-linecap="null"
                x="484"
                y="320"
                text-anchor="middle"
                xml:space="preserve"
                fill-opacity="1"
                stroke-opacity="1"
                id="txt_m22"
                v-if="txtFloors"
                v-text="txtFloor[12].name"
              />
              <text
                fill="#000000"
                stroke="#000000"
                stroke-width="0px"
                stroke-dasharray="null"
                stroke-linejoin="null"
                stroke-linecap="null"
                x="484"
                y="420"
                text-anchor="middle"
                xml:space="preserve"
                fill-opacity="1"
                stroke-opacity="1"
                id="txt_m21"
                v-if="txtFloors"
                v-text="txtFloor[11].name"
              />
              <text
                fill="#000000"
                stroke="#000000"
                stroke-width="0px"
                stroke-dasharray="null"
                stroke-linejoin="null"
                stroke-linecap="null"
                x="184"
                y="120"
                text-anchor="middle"
                xml:space="preserve"
                fill-opacity="1"
                stroke-opacity="1"
                id="txt_111"
                v-if="txtFloors"
                v-text="txtFloor[1].name"
              />
              <text
                fill="#000000"
                stroke="#000000"
                stroke-width="0px"
                stroke-dasharray="null"
                stroke-linejoin="null"
                stroke-linecap="null"
                x="83"
                y="120"
                text-anchor="middle"
                xml:space="preserve"
                fill-opacity="1"
                stroke-opacity="1"
                id="txt_auditorium"
                v-if="txtFloors"
                v-text="txtFloor[0].name"
              />
              <text
                fill="#000000"
                stroke="#000000"
                stroke-width="0px"
                stroke-dasharray="null"
                stroke-linejoin="null"
                stroke-linecap="null"
                x="313"
                y="290"
                text-anchor="middle"
                xml:space="preserve"
                fill-opacity="1"
                stroke-opacity="1"
                id="txt_m14"
                v-if="txtFloors"
                v-text="txtFloor[7].name"
              />
              <text
                fill="#000000"
                stroke="#000000"
                stroke-width="0px"
                stroke-dasharray="null"
                stroke-linejoin="null"
                stroke-linecap="null"
                x="313"
                y="390"
                text-anchor="middle"
                xml:space="preserve"
                fill-opacity="1"
                stroke-opacity="1"
                id="txt_m12"
                v-if="txtFloors"
                v-text="txtFloor[5].name"
              />
              <text
                fill="#000000"
                stroke="#000000"
                stroke-width="0px"
                stroke-dasharray="null"
                stroke-linejoin="null"
                stroke-linecap="null"
                x="313"
                y="340"
                text-anchor="middle"
                xml:space="preserve"
                fill-opacity="1"
                stroke-opacity="1"
                id="txt_m13"
                v-if="txtFloors"
                v-text="txtFloor[6].name"
              />
              <text
                fill="#000000"
                stroke="#000000"
                stroke-width="0px"
                stroke-dasharray="null"
                stroke-linejoin="null"
                stroke-linecap="null"
                x="364"
                y="290"
                text-anchor="middle"
                xml:space="preserve"
                fill-opacity="1"
                stroke-opacity="1"
                id="txt_m18"
                v-if="txtFloors"
                v-text="txtFloor[10].name"
              />
              <text
                fill="#000000"
                stroke="#000000"
                stroke-width="0px"
                stroke-dasharray="null"
                stroke-linejoin="null"
                stroke-linecap="null"
                x="364"
                y="390"
                text-anchor="middle"
                xml:space="preserve"
                fill-opacity="1"
                stroke-opacity="1"
                id="txt_m16"
                v-if="txtFloors"
                v-text="txtFloor[8].name"
              />
              <text
                fill="#000000"
                stroke="#000000"
                stroke-width="0px"
                stroke-dasharray="null"
                stroke-linejoin="null"
                stroke-linecap="null"
                x="364"
                y="340"
                text-anchor="middle"
                xml:space="preserve"
                fill-opacity="1"
                stroke-opacity="1"
                id="txt_m17"
                v-if="txtFloors"
                v-text="txtFloor[9].name"
              />
            </g>
          </svg>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import axios from "axios";

const axiosConfig = require("../../assets/config.json");

export default {
  name: "Floor1",
  created() {
    this.getRoomByFloor(1);
  },
  data() {
    return {
      txtFloor: []
    };
  },
  computed: {
    txtFloors() {
      return this.txtFloor.length;
    }
  },
  mounted() {},
  updated() {
    this.updateRoomStatusByFloor();
  },
  methods: {
    selectRoom(id, name, size, floor, path, active) {
      if (
        id != null &&
        name != null &&
        size != null &&
        floor != null &&
        path != null
      ) {
        if (active == "Y") {
          this.$parent.selectRoom(id, name, size, floor, path);
        }
      }
    },
    getRoomByFloor(floor) {
      const path =
        "http://" +
        axiosConfig.APIGATEWAY.HOST +
        ":" +
        axiosConfig.APIGATEWAY.PORT +
        "/api/" +
        axiosConfig.PATH.getRoomByFloor +
        "/" +
        floor;

      try {
        axios
          .get(path)
          .then(res => {
            var roomArrary = res.data;
            this.updateTxtFloor(roomArrary);
          })
          .catch(error => {
            console.log(error);
          });
      } catch (err) {
        console.log(err);
      }
    },
    updateTxtFloor(room) {
      for (var roomIndex in room) {
        this.txtFloor.push({
          id: room[roomIndex].room_id,
          name: room[roomIndex].room_name,
          size: room[roomIndex].room_size,
          floor: room[roomIndex].room_floor,
          pathImg: room[roomIndex].room_pathImage,
          active: room[roomIndex].room_active
        });
      }
    },
    getRoomStatusById(roomId, roomActive, rectId) {
      const path =
        "http://" +
        axiosConfig.APIGATEWAY.HOST +
        ":" +
        axiosConfig.APIGATEWAY.PORT +
        "/api/" +
        axiosConfig.PATH.getRoomStatusById +
        "/" +
        roomId;

      try {
        axios
          .get(path)
          .then(res => {
            var roomStatusArrary = res.data;
            if (roomActive != "N") {
              if (roomStatusArrary) {
                document
                  .getElementById(rectId)
                  .setAttribute("fill", "lightgreen");
              }
            }
          })
          .catch(error => {
            console.log(error);
          });
      } catch (err) {
        console.log(err);
      }
    },
    updateRoomStatusByFloor() {
      this.getRoomStatusById(
        this.txtFloor[0].id,
        this.txtFloor[0].active,
        "floor_1_auditorium"
      );
      this.getRoomStatusById(
        this.txtFloor[1].id,
        this.txtFloor[1].active,
        "floor_1_111"
      );
      this.getRoomStatusById(
        this.txtFloor[3].id,
        this.txtFloor[3].active,
        "floor_1_m03"
      );
      this.getRoomStatusById(
        this.txtFloor[4].id,
        this.txtFloor[4].active,
        "floor_1_m04"
      );
      this.getRoomStatusById(
        this.txtFloor[5].id,
        this.txtFloor[5].active,
        "floor_1_m12"
      );
      this.getRoomStatusById(
        this.txtFloor[6].id,
        this.txtFloor[6].active,
        "floor_1_m13"
      );
      this.getRoomStatusById(
        this.txtFloor[7].id,
        this.txtFloor[7].active,
        "floor_1_m14"
      );
      this.getRoomStatusById(
        this.txtFloor[8].id,
        this.txtFloor[8].active,
        "floor_1_m16"
      );
      this.getRoomStatusById(
        this.txtFloor[9].id,
        this.txtFloor[9].active,
        "floor_1_m17"
      );
      this.getRoomStatusById(
        this.txtFloor[10].id,
        this.txtFloor[10].active,
        "floor_1_m18"
      );
      this.getRoomStatusById(
        this.txtFloor[11].id,
        this.txtFloor[11].active,
        "floor_1_m21"
      );
      this.getRoomStatusById(
        this.txtFloor[12].id,
        this.txtFloor[12].active,
        "floor_1_m22"
      );
      this.getRoomStatusById(
        this.txtFloor[13].id,
        this.txtFloor[13].active,
        "floor_1_m23"
      );
    }
  }
};
</script>

<style scoped>
rect:hover {
  cursor: pointer;
  stroke-width: 2;
  stroke: #01579b;
}

text:hover {
  cursor: pointer;
}
</style>