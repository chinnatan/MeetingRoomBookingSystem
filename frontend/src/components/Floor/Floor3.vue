<template>
  <div>
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <svg
            id="floor3"
            width="100%"
            height="100%"
            overflow="visible"
            xmlns="http://www.w3.org/2000/svg"
            xmlns:svg="http://www.w3.org/2000/svg"
            viewBox="0 0 600 440"
            stroke="none"
          >
            <!-- Created with SVG-edit - http://svg-edit.googlecode.com/ -->
            <g>
              <title>Floor 3</title>
              <rect
                id="floor_3_335"
                height="62"
                width="92"
                y="10"
                x="413"
                stroke-width="0"
                stroke="#000000"
                fill="#bfbfbf"
                v-on:click="selectRoom(text.room.room335.id, text.room.room335.name, text.room.room335.size, text.room.room335.floor, text.room.room335.path, text.room.room335.active)"
              />
              <rect
                id="floor_3_334"
                height="42"
                width="92"
                y="80"
                x="413"
                stroke-width="0"
                stroke="#000000"
                fill="#bfbfbf"
                v-on:click="selectRoom(text.room.room334.id, text.room.room334.name, text.room.room334.size, text.room.room334.floor, text.room.room334.path, text.room.room334.active)"
              />
              <rect
                id="floor_3_332"
                height="42"
                width="92"
                y="180"
                x="413"
                stroke-width="0"
                stroke="#000000"
                fill="#bfbfbf"
                v-on:click="selectRoom(text.room.room332.id, text.room.room332.name, text.room.room332.size, text.room.room332.floor, text.room.room332.path, text.room.room332.active)"
              />
              <rect
                id="floor_3_333"
                height="42"
                width="92"
                y="130"
                x="413"
                stroke-width="0"
                stroke="#000000"
                fill="#bfbfbf"
                v-on:click="selectRoom(text.room.room333.id, text.room.room333.name, text.room.room333.size, text.room.room333.floor, text.room.room333.path, text.room.room333.active)"
              />
              <rect
                id="floor_3_308"
                height="132"
                width="92"
                y="60"
                x="100"
                stroke-width="0"
                stroke="#000000"
                fill="#bfbfbf"
                v-on:click="selectRoom(text.room.room308.id, text.room.room308.name, text.room.room308.size, text.room.room308.floor, text.room.room308.path, text.room.room308.active)"
              />
              <rect
                id="floor_3_306"
                height="82"
                width="92"
                y="200"
                x="100"
                stroke-width="0"
                stroke="#000000"
                fill="#bfbfbf"
                v-on:click="selectRoom(text.room.room306.id, text.room.room306.name, text.room.room306.size, text.room.room306.floor, text.room.room306.path, text.room.room306.active)"
              />
              <rect
                id="floor_3_304"
                height="134"
                width="92"
                y="290"
                x="99.25"
                stroke-width="0"
                stroke="#000000"
                fill="#bfbfbf"
                v-on:click="selectRoom(text.room.room304.id, text.room.room304.name, text.room.room304.size, text.room.room304.floor, text.room.room304.path, text.room.room304.active)"
              />
              <rect
                id="floor_3_331"
                height="42"
                width="92"
                y="230"
                x="413"
                stroke-width="0"
                stroke="#000000"
                fill="#bfbfbf"
                v-on:click="selectRoom(text.room.room331.id, text.room.room331.name, text.room.room331.size, text.room.room331.floor, text.room.room331.path, text.room.room331.active)"
              />
              <rect
                id="floor_3_330"
                height="42"
                width="92"
                y="280"
                x="413"
                stroke-width="0"
                stroke="#000000"
                fill="#bfbfbf"
                v-on:click="selectRoom(text.room.room330.id, text.room.room330.name, text.room.room330.size, text.room.room330.floor, text.room.room330.path, text.room.room330.active)"
              />
              <rect
                id="floor_3_328"
                height="72"
                width="46"
                y="30"
                x="330"
                stroke-width="0"
                stroke="#000000"
                fill="#bfbfbf"
                v-on:click="selectRoom(text.room.room328.id, text.room.room328.name, text.room.room328.size, text.room.room328.floor, text.room.room328.path, text.room.room328.active)"
              />
              <rect
                id="floor_3_329"
                height="92"
                width="92"
                y="330"
                x="413"
                stroke-width="0"
                stroke="#000000"
                fill="#bfbfbf"
                v-on:click="selectRoom(text.room.room329.id, text.room.room329.name, text.room.room329.size, text.room.room329.floor, text.room.room329.path, text.room.room329.active)"
              />
              <text
                xml:space="preserve"
                text-anchor="middle"
                id="txt_308"
                y="186"
                x="146"
                stroke-linecap="null"
                stroke-linejoin="null"
                stroke-dasharray="null"
                stroke-width="0"
                stroke="#000000"
                fill="#000000"
                v-if="text.room.room308.id"
                v-text="text.room.room308.name"
              ></text>
              <text
                id="txt_306"
                xml:space="preserve"
                text-anchor="middle"
                y="276"
                x="146"
                stroke-linecap="null"
                stroke-linejoin="null"
                stroke-dasharray="null"
                stroke-width="0"
                stroke="#000000"
                fill="#000000"
                v-if="text.room.room306.id"
                v-text="text.room.room306.name"
              ></text>
              <text
                id="txt_304"
                xml:space="preserve"
                text-anchor="middle"
                y="416"
                x="146"
                stroke-linecap="null"
                stroke-linejoin="null"
                stroke-dasharray="null"
                stroke-width="0"
                stroke="#000000"
                fill="#000000"
                v-if="text.room.room304.id"
                v-text="text.room.room304.name"
              ></text>
              <text
                id="txt_331"
                xml:space="preserve"
                text-anchor="middle"
                y="266"
                x="458"
                stroke-linecap="null"
                stroke-linejoin="null"
                stroke-dasharray="null"
                stroke-width="0"
                stroke="#000000"
                fill="#000000"
                v-if="text.room.room331.id"
                v-text="text.room.room331.name"
              ></text>
              <text
                id="txt_330"
                xml:space="preserve"
                text-anchor="middle"
                y="316"
                x="458"
                stroke-linecap="null"
                stroke-linejoin="null"
                stroke-dasharray="null"
                stroke-width="0"
                stroke="#000000"
                fill="#000000"
                v-if="text.room.room330.id"
                v-text="text.room.room330.name"
              ></text>
              <text
                id="txt_328"
                xml:space="preserve"
                text-anchor="middle"
                y="96"
                x="353"
                stroke-linecap="null"
                stroke-linejoin="null"
                stroke-dasharray="null"
                stroke-width="0"
                stroke="#000000"
                fill="#000000"
                v-if="text.room.room328.id"
                v-text="text.room.room328.name"
              ></text>
              <text
                id="txt_329"
                xml:space="preserve"
                text-anchor="middle"
                y="416"
                x="458"
                stroke-linecap="null"
                stroke-linejoin="null"
                stroke-dasharray="null"
                stroke-width="0"
                stroke="#000000"
                fill="#000000"
                v-if="text.room.room329.id"
                v-text="text.room.room329.name"
              ></text>
              <text
                id="txt_335"
                xml:space="preserve"
                text-anchor="middle"
                y="66"
                x="458"
                stroke-linecap="null"
                stroke-linejoin="null"
                stroke-dasharray="null"
                stroke-width="0"
                stroke="#000000"
                fill="#000000"
                v-if="text.room.room335.id"
                v-text="text.room.room335.name"
              ></text>
              <text
                id="txt_334"
                xml:space="preserve"
                text-anchor="middle"
                y="116"
                x="458"
                stroke-linecap="null"
                stroke-linejoin="null"
                stroke-dasharray="null"
                stroke-width="0"
                stroke="#000000"
                fill="#000000"
                v-if="text.room.room334.id"
                v-text="text.room.room334.name"
              ></text>
              <text
                id="txt_333"
                xml:space="preserve"
                text-anchor="middle"
                y="166"
                x="458"
                stroke-linecap="null"
                stroke-linejoin="null"
                stroke-dasharray="null"
                stroke-width="0"
                stroke="#000000"
                fill="#000000"
                v-if="text.room.room333.id"
                v-text="text.room.room333.name"
              ></text>
              <text
                id="txt_332"
                xml:space="preserve"
                text-anchor="middle"
                y="216"
                x="458"
                stroke-linecap="null"
                stroke-linejoin="null"
                stroke-dasharray="null"
                stroke-width="0"
                stroke="#000000"
                fill="#000000"
                v-if="text.room.room332.id"
                v-text="text.room.room332.name"
              ></text>
            </g>
          </svg>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import axios from "axios";
const axiosConfig = require("../../assets/config.json");

const HOST = axiosConfig.APIGATEWAY.HOST;
const PORT = axiosConfig.APIGATEWAY.PORT;
const API = "http://" + HOST + ":" + PORT

export default {
  name: "Floor3",
  created() {
    this.getRoomByName("304");
    this.getRoomByName("306");
    this.getRoomByName("308");
    this.getRoomByName("328");
    this.getRoomByName("329");
    this.getRoomByName("330");
    this.getRoomByName("331");
    this.getRoomByName("332");
    this.getRoomByName("333");
    this.getRoomByName("334");
    this.getRoomByName("335");
  },
  data() {
    return {
      text: {
        room: {
          room304: {
            id: "",
            name: "",
            size: "",
            floor: "",
            path: "",
            student: "",
            professor: "",
            staff: "",
            active: ""
          },
          room306: {
            id: "",
            name: "",
            size: "",
            floor: "",
            path: "",
            student: "",
            professor: "",
            staff: "",
            active: ""
          },
          room308: {
            id: "",
            name: "",
            size: "",
            floor: "",
            path: "",
            student: "",
            professor: "",
            staff: "",
            active: ""
          },
          room328: {
            id: "",
            name: "",
            size: "",
            floor: "",
            path: "",
            student: "",
            professor: "",
            staff: "",
            active: ""
          },
          room329: {
            id: "",
            name: "",
            size: "",
            floor: "",
            path: "",
            student: "",
            professor: "",
            staff: "",
            active: ""
          },
          room330: {
            id: "",
            name: "",
            size: "",
            floor: "",
            path: "",
            student: "",
            professor: "",
            staff: "",
            active: ""
          },
          room331: {
            id: "",
            name: "",
            size: "",
            floor: "",
            path: "",
            student: "",
            professor: "",
            staff: "",
            active: ""
          },
          room332: {
            id: "",
            name: "",
            size: "",
            floor: "",
            path: "",
            student: "",
            professor: "",
            staff: "",
            active: ""
          },
          room333: {
            id: "",
            name: "",
            size: "",
            floor: "",
            path: "",
            student: "",
            professor: "",
            staff: "",
            active: ""
          },
          room334: {
            id: "",
            name: "",
            size: "",
            floor: "",
            path: "",
            student: "",
            professor: "",
            staff: "",
            active: ""
          },
          room335: {
            id: "",
            name: "",
            size: "",
            floor: "",
            path: "",
            student: "",
            professor: "",
            staff: "",
            active: ""
          }
        }
      },
      intervalUpdate: null
    };
  },
  computed: {
    
  },
  mounted() {
    this.intervalUpdate = setInterval(function () {
      this.updateRoomActiveAllFloor();
    }.bind(this), 60000)
  },
  beforeUpdate() {
    this.updateRoomActiveAllFloor()
  },
  update() {
    this.updateRoomActiveAllFloor()
  },
  methods: {
    selectRoom(id, name, size, floor, path, active) {
      if (
        id != null &&
        name != null &&
        size != null &&
        floor != null &&
        path != null
      ) {
        if (active) {
          this.$parent.selectRoom(id, name, size, floor, path);
        }
      }
    },
    getRoomByName(name) {
      const path = API + "/api" + axiosConfig.PATH.getRoomByName + "/" + name;

      try {
        axios
          .get(path)
          .then(res => {
            var room = res.data;
            this.setRoomInMap(room[0].RoomName, room);
          })
          .catch(error => {
            console.log(error);
          });
      } catch (err) {
        console.log(err);
      }
    },
    setRoomInMap(name, room) {
      name = name.toLowerCase();
      if (name == "304") {
        this.text.room.room304.id = room[0].RoomId;
        this.text.room.room304.name = room[0].RoomName;
        this.text.room.room304.size = room[0].RoomSize;
        this.text.room.room304.floor = room[0].RoomFloor;
        this.text.room.room304.path = room[0].RoomPathImage;
        this.text.room.room304.student = room[0].RoomPermissionStudent;
        this.text.room.room304.professor = room[0].RoomPermissionProfessor;
        this.text.room.room304.staff = room[0].RoomPermissionStaff;
        this.text.room.room304.active = room[0].RoomActive;
      } else if (name == "306") {
        this.text.room.room306.id = room[0].RoomId;
        this.text.room.room306.name = room[0].RoomName;
        this.text.room.room306.size = room[0].RoomSize;
        this.text.room.room306.floor = room[0].RoomFloor;
        this.text.room.room306.path = room[0].RoomPathImage;
        this.text.room.room306.student = room[0].RoomPermissionStudent;
        this.text.room.room306.professor = room[0].RoomPermissionProfessor;
        this.text.room.room306.staff = room[0].RoomPermissionStaff;
        this.text.room.room306.active = room[0].RoomActive;
      } else if (name == "308") {
        this.text.room.room308.id = room[0].RoomId;
        this.text.room.room308.name = room[0].RoomName;
        this.text.room.room308.size = room[0].RoomSize;
        this.text.room.room308.floor = room[0].RoomFloor;
        this.text.room.room308.path = room[0].RoomPathImage;
        this.text.room.room308.student = room[0].RoomPermissionStudent;
        this.text.room.room308.professor = room[0].RoomPermissionProfessor;
        this.text.room.room308.staff = room[0].RoomPermissionStaff;
        this.text.room.room308.active = room[0].RoomActive;
      } else if (name == "328") {
        this.text.room.room328.id = room[0].RoomId;
        this.text.room.room328.name = room[0].RoomName;
        this.text.room.room328.size = room[0].RoomSize;
        this.text.room.room328.floor = room[0].RoomFloor;
        this.text.room.room328.path = room[0].RoomPathImage;
        this.text.room.room328.student = room[0].RoomPermissionStudent;
        this.text.room.room328.professor = room[0].RoomPermissionProfessor;
        this.text.room.room328.staff = room[0].RoomPermissionStaff;
        this.text.room.room328.active = room[0].RoomActive;
      } else if (name == "329") {
        this.text.room.room329.id = room[0].RoomId;
        this.text.room.room329.name = room[0].RoomName;
        this.text.room.room329.size = room[0].RoomSize;
        this.text.room.room329.floor = room[0].RoomFloor;
        this.text.room.room329.path = room[0].RoomPathImage;
        this.text.room.room329.student = room[0].RoomPermissionStudent;
        this.text.room.room329.professor = room[0].RoomPermissionProfessor;
        this.text.room.room329.staff = room[0].RoomPermissionStaff;
        this.text.room.room329.active = room[0].RoomActive;
      } else if (name == "330") {
        this.text.room.room330.id = room[0].RoomId;
        this.text.room.room330.name = room[0].RoomName;
        this.text.room.room330.size = room[0].RoomSize;
        this.text.room.room330.floor = room[0].RoomFloor;
        this.text.room.room330.path = room[0].RoomPathImage;
        this.text.room.room330.student = room[0].RoomPermissionStudent;
        this.text.room.room330.professor = room[0].RoomPermissionProfessor;
        this.text.room.room330.staff = room[0].RoomPermissionStaff;
        this.text.room.room330.active = room[0].RoomActive;
      } else if (name == "331") {
        this.text.room.room331.id = room[0].RoomId;
        this.text.room.room331.name = room[0].RoomName;
        this.text.room.room331.size = room[0].RoomSize;
        this.text.room.room331.floor = room[0].RoomFloor;
        this.text.room.room331.path = room[0].RoomPathImage;
        this.text.room.room331.student = room[0].RoomPermissionStudent;
        this.text.room.room331.professor = room[0].RoomPermissionProfessor;
        this.text.room.room331.staff = room[0].RoomPermissionStaff;
        this.text.room.room331.active = room[0].RoomActive;
      } else if (name == "332") {
        this.text.room.room332.id = room[0].RoomId;
        this.text.room.room332.name = room[0].RoomName;
        this.text.room.room332.size = room[0].RoomSize;
        this.text.room.room332.floor = room[0].RoomFloor;
        this.text.room.room332.path = room[0].RoomPathImage;
        this.text.room.room332.student = room[0].RoomPermissionStudent;
        this.text.room.room332.professor = room[0].RoomPermissionProfessor;
        this.text.room.room332.staff = room[0].RoomPermissionStaff;
        this.text.room.room332.active = room[0].RoomActive;
      } else if (name == "333") {
        this.text.room.room333.id = room[0].RoomId;
        this.text.room.room333.name = room[0].RoomName;
        this.text.room.room333.size = room[0].RoomSize;
        this.text.room.room333.floor = room[0].RoomFloor;
        this.text.room.room333.path = room[0].RoomPathImage;
        this.text.room.room333.student = room[0].RoomPermissionStudent;
        this.text.room.room333.professor = room[0].RoomPermissionProfessor;
        this.text.room.room333.staff = room[0].RoomPermissionStaff;
        this.text.room.room333.active = room[0].RoomActive;
      } else if (name == "334") {
        this.text.room.room334.id = room[0].RoomId;
        this.text.room.room334.name = room[0].RoomName;
        this.text.room.room334.size = room[0].RoomSize;
        this.text.room.room334.floor = room[0].RoomFloor;
        this.text.room.room334.path = room[0].RoomPathImage;
        this.text.room.room334.student = room[0].RoomPermissionStudent;
        this.text.room.room334.professor = room[0].RoomPermissionProfessor;
        this.text.room.room334.staff = room[0].RoomPermissionStaff;
        this.text.room.room334.active = room[0].RoomActive;
      } else if (name == "335") {
        this.text.room.room335.id = room[0].RoomId;
        this.text.room.room335.name = room[0].RoomName;
        this.text.room.room335.size = room[0].RoomSize;
        this.text.room.room335.floor = room[0].RoomFloor;
        this.text.room.room335.path = room[0].RoomPathImage;
        this.text.room.room335.student = room[0].RoomPermissionStudent;
        this.text.room.room335.professor = room[0].RoomPermissionProfessor;
        this.text.room.room335.staff = room[0].RoomPermissionStaff;
        this.text.room.room335.active = room[0].RoomActive;
      }
    },
    getRoomActiveById(roomId, roomActive, student, professor, staff, rectId) {
      if (roomActive) {
        if (
          JSON.parse(localStorage.getItem("user")).role.toUpperCase() ==
          "IT STUDENT"
        ) {
          if (student) {
            this.getBookingScheduleCurDateAndCurTime(roomId, rectId)
          } else {
            document.getElementById(rectId).setAttribute("fill", "#bfbfbf");
          }
        }

        if (
          JSON.parse(localStorage.getItem("user")).role.toUpperCase() ==
          "LECTURE"
        ) {
          if (professor) {
            this.getBookingScheduleCurDateAndCurTime(roomId, rectId)
          } else {
            document.getElementById(rectId).setAttribute("fill", "#bfbfbf");
          }
        }

        if (
          JSON.parse(localStorage.getItem("user")).role.toUpperCase() ==
          "STAFF"
        ) {
          if (staff) {
            this.getBookingScheduleCurDateAndCurTime(roomId, rectId)
          } else {
            document.getElementById(rectId).setAttribute("fill", "#bfbfbf");
          }
        }

        if (
          JSON.parse(localStorage.getItem("user")).role.toUpperCase() ==
          "ADMIN"
        ) {
          if (student || professor || staff) {
            this.getBookingScheduleCurDateAndCurTime(roomId, rectId)
          } else {
            document.getElementById(rectId).setAttribute("fill", "#bfbfbf");
          }
        }
      }
    },
    updateRoomActiveAllFloor() {
      this.getRoomActiveById(
        this.text.room.room304.id,
        this.text.room.room304.active,
        this.text.room.room304.student,
        this.text.room.room304.professor,
        this.text.room.room304.staff,
        "floor_3_304"
      );
      this.getRoomActiveById(
        this.text.room.room306.id,
        this.text.room.room306.active,
        this.text.room.room306.student,
        this.text.room.room306.professor,
        this.text.room.room306.staff,
        "floor_3_306"
      );
      this.getRoomActiveById(
        this.text.room.room308.id,
        this.text.room.room308.active,
        this.text.room.room308.student,
        this.text.room.room308.professor,
        this.text.room.room308.staff,
        "floor_3_308"
      );
      this.getRoomActiveById(
        this.text.room.room328.id,
        this.text.room.room328.active,
        this.text.room.room328.student,
        this.text.room.room328.professor,
        this.text.room.room328.staff,
        "floor_3_328"
      );
      this.getRoomActiveById(
        this.text.room.room329.id,
        this.text.room.room329.active,
        this.text.room.room329.student,
        this.text.room.room329.professor,
        this.text.room.room329.staff,
        "floor_3_329"
      );
      this.getRoomActiveById(
        this.text.room.room330.id,
        this.text.room.room330.active,
        this.text.room.room330.student,
        this.text.room.room330.professor,
        this.text.room.room330.staff,
        "floor_3_330"
      );
      this.getRoomActiveById(
        this.text.room.room331.id,
        this.text.room.room331.active,
        this.text.room.room331.student,
        this.text.room.room331.professor,
        this.text.room.room331.staff,
        "floor_3_331"
      );
      this.getRoomActiveById(
        this.text.room.room332.id,
        this.text.room.room332.active,
        this.text.room.room332.student,
        this.text.room.room332.professor,
        this.text.room.room332.staff,
        "floor_3_332"
      );
      this.getRoomActiveById(
        this.text.room.room333.id,
        this.text.room.room333.active,
        this.text.room.room333.student,
        this.text.room.room333.professor,
        this.text.room.room333.staff,
        "floor_3_333"
      );
      this.getRoomActiveById(
        this.text.room.room334.id,
        this.text.room.room334.active,
        this.text.room.room334.student,
        this.text.room.room334.professor,
        this.text.room.room334.staff,
        "floor_3_334"
      );
      this.getRoomActiveById(
        this.text.room.room335.id,
        this.text.room.room335.active,
        this.text.room.room335.student,
        this.text.room.room335.professor,
        this.text.room.room335.staff,
        "floor_3_335"
      );
    },
    getBookingScheduleCurDateAndCurTime(roomId, rectId) {
      const path = API + "/api/room/" + roomId + "/booking/time/now";

      axios
        .get(path)
        .then(res => {
          if (res.data[0] != null) {
            document.getElementById(rectId).setAttribute("fill", "red");
          } else if(res.data.message != null) {
            document.getElementById(rectId).setAttribute("fill", "#00ff00");
          }
        })
        .catch(error => {
          console.log(error)
        });
    }
  }
};
</script>

<style scoped>
rect:hover {
  cursor: pointer;
  stroke-width: 2;
  stroke: #01579b;
}

text:hover {
  cursor: pointer;
}
</style>