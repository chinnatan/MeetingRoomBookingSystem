<template>
  <div>
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <svg
            id="floor2"
            width="100%"
            height="100%"
            overflow="visible"
            xmlns="http://www.w3.org/2000/svg"
            xmlns:svg="http://www.w3.org/2000/svg"
            viewBox="0 0 600 440"
            stroke="none"
          >
            <!-- Created with SVG-edit - http://svg-edit.googlecode.com/ -->
            <g>
              <title>Floor 2</title>
              <rect
                id="floor_2_226"
                height="92"
                width="92"
                y="90"
                x="413"
                stroke-width="0"
                stroke="#000000"
                fill="#bfbfbf"
                v-on:click="selectRoom(text.room.room226.id, text.room.room226.name, text.room.room226.size, text.room.room226.floor, text.room.room226.path, text.room.room226.active)"
              />
              <rect
                id="floor_2_225"
                height="62"
                width="92"
                y="190"
                x="413"
                stroke-width="0"
                stroke="#000000"
                fill="#bfbfbf"
                v-on:click="selectRoom(text.room.room225.id, text.room.room225.name, text.room.room225.size, text.room.room225.floor, text.room.room225.path, text.room.room225.active)"
              />
              <rect
                id="floor_2_223"
                height="92"
                width="92"
                y="330"
                x="413"
                stroke-width="0"
                stroke="#000000"
                fill="#bfbfbf"
                v-on:click="selectRoom(text.room.room223.id, text.room.room223.name, text.room.room223.size, text.room.room223.floor, text.room.room223.path, text.room.room223.active)"
              />
              <rect
                id="floor_2_224"
                height="62"
                width="92"
                y="260"
                x="413"
                stroke-width="0"
                stroke="#000000"
                fill="#bfbfbf"
                v-on:click="selectRoom(text.room.room224.id, text.room.room224.name, text.room.room224.size, text.room.room224.floor, text.room.room224.path, text.room.room224.active)"
              />
              <rect
                id="floor_2_207"
                height="152"
                width="92"
                y="10"
                x="100"
                stroke-width="0"
                stroke="#000000"
                fill="#bfbfbf"
                v-on:click="selectRoom(text.room.room207.id, text.room.room207.name, text.room.room207.size, text.room.room207.floor, text.room.room207.path, text.room.room207.active)"
              />
              <rect
                id="floor_2_205"
                height="82"
                width="92"
                y="170"
                x="100"
                stroke-width="0"
                stroke="#000000"
                fill="#bfbfbf"
                v-on:click="selectRoom(text.room.room205.id, text.room.room205.name, text.room.room205.size, text.room.room205.floor, text.room.room205.path, text.room.room205.active)"
              />
              <rect
                id="floor_2_203"
                height="164"
                width="92"
                y="260"
                x="99.25"
                stroke-width="0"
                stroke="#000000"
                fill="#bfbfbf"
                v-on:click="selectRoom(text.room.room203.id, text.room.room203.name, text.room.room203.size, text.room.room203.floor, text.room.room203.path, text.room.room203.active)"
              />
              <rect
                id="floor_2_219"
                height="92"
                width="46"
                y="200"
                x="280"
                stroke-width="0"
                stroke="#000000"
                fill="#bfbfbf"
                v-on:click="selectRoom(text.room.room219.id, text.room.room219.name, text.room.room219.size, text.room.room219.floor, text.room.room219.path, text.room.room219.active)"
              />
              <rect
                id="floor_2_218"
                height="92"
                width="46"
                y="300"
                x="280"
                stroke-width="0"
                stroke="#000000"
                fill="#bfbfbf"
                v-on:click="selectRoom(text.room.room218.id, text.room.room218.name, text.room.room218.size, text.room.room218.floor, text.room.room218.path, text.room.room218.active)"
              />
              <rect
                id="floor_2_222"
                height="72"
                width="46"
                y="200"
                x="330"
                stroke-width="0"
                stroke="#000000"
                fill="#bfbfbf"
                v-on:click="selectRoom(text.room.room222.id, text.room.room222.name, text.room.room222.size, text.room.room222.floor, text.room.room222.path, text.room.room222.active)"
              />
              <rect
                id="floor_2_221"
                height="52"
                width="46"
                y="280"
                x="330"
                stroke-width="0"
                stroke="#000000"
                fill="#bfbfbf"
                v-on:click="selectRoom(text.room.room221.id, text.room.room221.name, text.room.room221.size, text.room.room221.floor, text.room.room221.path, text.room.room221.active)"
              />
              <rect
                id="floor_2_220"
                height="52"
                width="46"
                y="340"
                x="330"
                stroke-width="0"
                stroke="#000000"
                fill="#bfbfbf"
                v-on:click="selectRoom(text.room.room220.id, text.room.room220.name, text.room.room220.size, text.room.room220.floor, text.room.room220.path, text.room.room220.active)"
              />
              <text
                xml:space="preserve"
                text-anchor="middle"
                id="txt_207"
                y="156"
                x="146"
                stroke-linecap="null"
                stroke-linejoin="null"
                stroke-dasharray="null"
                stroke-width="0"
                stroke="#000000"
                fill="#000000"
                v-if="text.room.room207.id"
                v-text="text.room.room207.name"
              ></text>
              <text
                id="txt_205"
                xml:space="preserve"
                text-anchor="middle"
                y="246"
                x="146"
                stroke-linecap="null"
                stroke-linejoin="null"
                stroke-dasharray="null"
                stroke-width="0"
                stroke="#000000"
                fill="#000000"
                v-if="text.room.room205.id"
                v-text="text.room.room205.name"
              ></text>
              <text
                id="txt_203"
                xml:space="preserve"
                text-anchor="middle"
                y="416"
                x="146"
                stroke-linecap="null"
                stroke-linejoin="null"
                stroke-dasharray="null"
                stroke-width="0"
                stroke="#000000"
                fill="#000000"
                v-if="text.room.room203.id"
                v-text="text.room.room203.name"
              ></text>
              <text
                id="txt_219"
                xml:space="preserve"
                text-anchor="middle"
                y="286"
                x="304"
                stroke-linecap="null"
                stroke-linejoin="null"
                stroke-dasharray="null"
                stroke-width="0"
                stroke="#000000"
                fill="#000000"
                v-if="text.room.room219.id"
                v-text="text.room.room219.name"
              ></text>
              <text
                id="txt_218"
                xml:space="preserve"
                text-anchor="middle"
                y="386"
                x="304"
                stroke-linecap="null"
                stroke-linejoin="null"
                stroke-dasharray="null"
                stroke-width="0"
                stroke="#000000"
                fill="#000000"
                v-if="text.room.room218.id"
                v-text="text.room.room218.name"
              ></text>
              <text
                id="txt_222"
                xml:space="preserve"
                text-anchor="middle"
                y="266"
                x="353"
                stroke-linecap="null"
                stroke-linejoin="null"
                stroke-dasharray="null"
                stroke-width="0"
                stroke="#000000"
                fill="#000000"
                v-if="text.room.room222.id"
                v-text="text.room.room222.name"
              ></text>
              <text
                id="txt_221"
                xml:space="preserve"
                text-anchor="middle"
                y="326"
                x="353"
                stroke-linecap="null"
                stroke-linejoin="null"
                stroke-dasharray="null"
                stroke-width="0"
                stroke="#000000"
                fill="#000000"
                v-if="text.room.room221.id"
                v-text="text.room.room221.name"
              ></text>
              <text
                id="txt_220"
                xml:space="preserve"
                text-anchor="middle"
                y="386"
                x="353"
                stroke-linecap="null"
                stroke-linejoin="null"
                stroke-dasharray="null"
                stroke-width="0"
                stroke="#000000"
                fill="#000000"
                v-if="text.room.room220.id"
                v-text="text.room.room220.name"
              ></text>
              <text
                id="txt_226"
                xml:space="preserve"
                text-anchor="middle"
                y="176"
                x="458"
                stroke-linecap="null"
                stroke-linejoin="null"
                stroke-dasharray="null"
                stroke-width="0"
                stroke="#000000"
                fill="#000000"
                v-if="text.room.room226.id"
                v-text="text.room.room226.name"
              ></text>
              <text
                id="txt_225"
                xml:space="preserve"
                text-anchor="middle"
                y="246"
                x="458"
                stroke-linecap="null"
                stroke-linejoin="null"
                stroke-dasharray="null"
                stroke-width="0"
                stroke="#000000"
                fill="#000000"
                v-if="text.room.room225.id"
                v-text="text.room.room225.name"
              ></text>
              <text
                id="txt_224"
                xml:space="preserve"
                text-anchor="middle"
                y="316"
                x="458"
                stroke-linecap="null"
                stroke-linejoin="null"
                stroke-dasharray="null"
                stroke-width="0"
                stroke="#000000"
                fill="#000000"
                v-if="text.room.room224.id"
                v-text="text.room.room224.name"
              ></text>
              <text
                id="txt_223"
                xml:space="preserve"
                text-anchor="middle"
                y="416"
                x="458"
                stroke-linecap="null"
                stroke-linejoin="null"
                stroke-dasharray="null"
                stroke-width="0"
                stroke="#000000"
                fill="#000000"
                v-if="text.room.room223.id"
                v-text="text.room.room223.name"
              ></text>
            </g>
          </svg>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import axios from "axios";
const axiosConfig = require("../../assets/config.json");

export default {
  name: "Floor2",
  created() {
    this.getRoomByName("203");
    this.getRoomByName("205");
    this.getRoomByName("207");
    this.getRoomByName("218");
    this.getRoomByName("219");
    this.getRoomByName("220");
    this.getRoomByName("221");
    this.getRoomByName("222");
    this.getRoomByName("223");
    this.getRoomByName("224");
    this.getRoomByName("225");
    this.getRoomByName("226");
  },
  data() {
    return {
      text: {
        room: {
          room203: {
            id: "",
            name: "",
            size: "",
            floor: "",
            path: "",
            student: "",
            professor: "",
            officer: "",
            active: ""
          },
          room205: {
            id: "",
            name: "",
            size: "",
            floor: "",
            path: "",
            student: "",
            professor: "",
            officer: "",
            active: ""
          },
          room207: {
            id: "",
            name: "",
            size: "",
            floor: "",
            path: "",
            student: "",
            professor: "",
            officer: "",
            active: ""
          },
          room218: {
            id: "",
            name: "",
            size: "",
            floor: "",
            path: "",
            student: "",
            professor: "",
            officer: "",
            active: ""
          },
          room219: {
            id: "",
            name: "",
            size: "",
            floor: "",
            path: "",
            student: "",
            professor: "",
            officer: "",
            active: ""
          },
          room220: {
            id: "",
            name: "",
            size: "",
            floor: "",
            path: "",
            student: "",
            professor: "",
            officer: "",
            active: ""
          },
          room221: {
            id: "",
            name: "",
            size: "",
            floor: "",
            path: "",
            student: "",
            professor: "",
            officer: "",
            active: ""
          },
          room222: {
            id: "",
            name: "",
            size: "",
            floor: "",
            path: "",
            student: "",
            professor: "",
            officer: "",
            active: ""
          },
          room223: {
            id: "",
            name: "",
            size: "",
            floor: "",
            path: "",
            student: "",
            professor: "",
            officer: "",
            active: ""
          },
          room224: {
            id: "",
            name: "",
            size: "",
            floor: "",
            path: "",
            student: "",
            professor: "",
            officer: "",
            active: ""
          },
          room225: {
            id: "",
            name: "",
            size: "",
            floor: "",
            path: "",
            student: "",
            professor: "",
            officer: "",
            active: ""
          },
          room226: {
            id: "",
            name: "",
            size: "",
            floor: "",
            path: "",
            student: "",
            professor: "",
            officer: "",
            active: ""
          }
        }
      },
      intervalUpdate: null
    };
  },
  computed: {

  },
  mounted() {
    this.intervalUpdate = setInterval(function () {
      this.updateRoomActiveAllFloor();
    }.bind(this), 60000)
  },
  beforeUpdate() {
    this.updateRoomActiveAllFloor();
  },
  update() {
    this.updateRoomActiveAllFloor();
  },
  beforeDestroy() {
    clearInterval(this.intervalUpdate)
  },
  methods: {
    selectRoom(id, name, size, floor, path, active) {
      if (
        id != null &&
        name != null &&
        size != null &&
        floor != null &&
        path != null
      ) {
        if (active) {
          this.$parent.selectRoom(id, name, size, floor, path);
        }
      }
    },
    getRoomByName(name) {
      const path =
        "http://" +
        axiosConfig.APIGATEWAY.HOST +
        ":" +
        axiosConfig.APIGATEWAY.PORT +
        "/api" +
        axiosConfig.PATH.getRoomByName +
        "/" +
        name;

      try {
        axios
          .get(path)
          .then(res => {
            var room = res.data;
            this.setRoomInMap(room[0].RoomName, room);
          })
          .catch(error => {
            console.log(error);
          });
      } catch (err) {
        console.log(err);
      }
    },
    setRoomInMap(name, room) {
      name = name.toLowerCase();
      if (name == "203") {
        this.text.room.room203.id = room[0].RoomId;
        this.text.room.room203.name = room[0].RoomName;
        this.text.room.room203.size = room[0].RoomSize;
        this.text.room.room203.floor = room[0].RoomFloor;
        this.text.room.room203.path = room[0].RoomPathImage;
        this.text.room.room203.student = room[0].RoomPermissionStudent;
        this.text.room.room203.professor = room[0].RoomPermissionProfessor;
        this.text.room.room203.officer = room[0].RoomPermissionOfficer;
        this.text.room.room203.active = room[0].RoomActive;
      } else if (name == "205") {
        this.text.room.room205.id = room[0].RoomId;
        this.text.room.room205.name = room[0].RoomName;
        this.text.room.room205.size = room[0].RoomSize;
        this.text.room.room205.floor = room[0].RoomFloor;
        this.text.room.room205.path = room[0].RoomPathImage;
        this.text.room.room205.student = room[0].RoomPermissionStudent;
        this.text.room.room205.professor = room[0].RoomPermissionProfessor;
        this.text.room.room205.officer = room[0].RoomPermissionOfficer;
        this.text.room.room205.active = room[0].RoomActive;
      } else if (name == "207") {
        this.text.room.room207.id = room[0].RoomId;
        this.text.room.room207.name = room[0].RoomName;
        this.text.room.room207.size = room[0].RoomSize;
        this.text.room.room207.floor = room[0].RoomFloor;
        this.text.room.room207.path = room[0].RoomPathImage;
        this.text.room.room207.student = room[0].RoomPermissionStudent;
        this.text.room.room207.professor = room[0].RoomPermissionProfessor;
        this.text.room.room207.officer = room[0].RoomPermissionOfficer;
        this.text.room.room207.active = room[0].RoomActive;
      } else if (name == "218") {
        this.text.room.room218.id = room[0].RoomId;
        this.text.room.room218.name = room[0].RoomName;
        this.text.room.room218.size = room[0].RoomSize;
        this.text.room.room218.floor = room[0].RoomFloor;
        this.text.room.room218.path = room[0].RoomPathImage;
        this.text.room.room218.student = room[0].RoomPermissionStudent;
        this.text.room.room218.professor = room[0].RoomPermissionProfessor;
        this.text.room.room218.officer = room[0].RoomPermissionOfficer;
        this.text.room.room218.active = room[0].RoomActive;
      } else if (name == "219") {
        this.text.room.room219.id = room[0].RoomId;
        this.text.room.room219.name = room[0].RoomName;
        this.text.room.room219.size = room[0].RoomSize;
        this.text.room.room219.floor = room[0].RoomFloor;
        this.text.room.room219.path = room[0].RoomPathImage;
        this.text.room.room219.student = room[0].RoomPermissionStudent;
        this.text.room.room219.professor = room[0].RoomPermissionProfessor;
        this.text.room.room219.officer = room[0].RoomPermissionOfficer;
        this.text.room.room219.active = room[0].RoomActive;
      } else if (name == "220") {
        this.text.room.room220.id = room[0].RoomId;
        this.text.room.room220.name = room[0].RoomName;
        this.text.room.room220.size = room[0].RoomSize;
        this.text.room.room220.floor = room[0].RoomFloor;
        this.text.room.room220.path = room[0].RoomPathImage;
        this.text.room.room220.student = room[0].RoomPermissionStudent;
        this.text.room.room220.professor = room[0].RoomPermissionProfessor;
        this.text.room.room220.officer = room[0].RoomPermissionOfficer;
        this.text.room.room220.active = room[0].RoomActive;
      } else if (name == "221") {
        this.text.room.room221.id = room[0].RoomId;
        this.text.room.room221.name = room[0].RoomName;
        this.text.room.room221.size = room[0].RoomSize;
        this.text.room.room221.floor = room[0].RoomFloor;
        this.text.room.room221.path = room[0].RoomPathImage;
        this.text.room.room221.student = room[0].RoomPermissionStudent;
        this.text.room.room221.professor = room[0].RoomPermissionProfessor;
        this.text.room.room221.officer = room[0].RoomPermissionOfficer;
        this.text.room.room221.active = room[0].RoomActive;
      } else if (name == "222") {
        this.text.room.room222.id = room[0].RoomId;
        this.text.room.room222.name = room[0].RoomName;
        this.text.room.room222.size = room[0].RoomSize;
        this.text.room.room222.floor = room[0].RoomFloor;
        this.text.room.room222.path = room[0].RoomPathImage;
        this.text.room.room222.student = room[0].RoomPermissionStudent;
        this.text.room.room222.professor = room[0].RoomPermissionProfessor;
        this.text.room.room222.officer = room[0].RoomPermissionOfficer;
        this.text.room.room222.active = room[0].RoomActive;
      } else if (name == "223") {
        this.text.room.room223.id = room[0].RoomId;
        this.text.room.room223.name = room[0].RoomName;
        this.text.room.room223.size = room[0].RoomSize;
        this.text.room.room223.floor = room[0].RoomFloor;
        this.text.room.room223.path = room[0].RoomPathImage;
        this.text.room.room223.student = room[0].RoomPermissionStudent;
        this.text.room.room223.professor = room[0].RoomPermissionProfessor;
        this.text.room.room223.officer = room[0].RoomPermissionOfficer;
        this.text.room.room223.active = room[0].RoomActive;
      } else if (name == "224") {
        this.text.room.room224.id = room[0].RoomId;
        this.text.room.room224.name = room[0].RoomName;
        this.text.room.room224.size = room[0].RoomSize;
        this.text.room.room224.floor = room[0].RoomFloor;
        this.text.room.room224.path = room[0].RoomPathImage;
        this.text.room.room224.student = room[0].RoomPermissionStudent;
        this.text.room.room224.professor = room[0].RoomPermissionProfessor;
        this.text.room.room224.officer = room[0].RoomPermissionOfficer;
        this.text.room.room224.active = room[0].RoomActive;
      } else if (name == "225") {
        this.text.room.room225.id = room[0].RoomId;
        this.text.room.room225.name = room[0].RoomName;
        this.text.room.room225.size = room[0].RoomSize;
        this.text.room.room225.floor = room[0].RoomFloor;
        this.text.room.room225.path = room[0].RoomPathImage;
        this.text.room.room225.student = room[0].RoomPermissionStudent;
        this.text.room.room225.professor = room[0].RoomPermissionProfessor;
        this.text.room.room225.officer = room[0].RoomPermissionOfficer;
        this.text.room.room225.active = room[0].RoomActive;
      } else if (name == "226") {
        this.text.room.room226.id = room[0].RoomId;
        this.text.room.room226.name = room[0].RoomName;
        this.text.room.room226.size = room[0].RoomSize;
        this.text.room.room226.floor = room[0].RoomFloor;
        this.text.room.room226.path = room[0].RoomPathImage;
        this.text.room.room226.student = room[0].RoomPermissionStudent;
        this.text.room.room226.professor = room[0].RoomPermissionProfessor;
        this.text.room.room226.officer = room[0].RoomPermissionOfficer;
        this.text.room.room226.active = room[0].RoomActive;
      }
    },
    getRoomActiveById(roomId, roomActive, student, professor, officer, rectId) {
      if (roomActive) {
        if (
          JSON.parse(localStorage.getItem("user")).role.toUpperCase() ==
          "IT STUDENT"
        ) {
          if (student) {
            this.getBookingScheduleCurDateAndCurTime(roomId, rectId)
          } else {
            document.getElementById(rectId).setAttribute("fill", "#bfbfbf");
          }
        }

        if (
          JSON.parse(localStorage.getItem("user")).role.toUpperCase() ==
          "PROFESSOR"
        ) {
          if (professor) {
            document.getElementById(rectId).setAttribute("fill", "#00ff00");
          } else {
            document.getElementById(rectId).setAttribute("fill", "#bfbfbf");
          }
        }

        if (
          JSON.parse(localStorage.getItem("user")).role.toUpperCase() ==
          "OFFICER"
        ) {
          if (officer) {
            document.getElementById(rectId).setAttribute("fill", "#00ff00");
          } else {
            document.getElementById(rectId).setAttribute("fill", "#bfbfbf");
          }
        }
      }
    },
    updateRoomActiveAllFloor() {
      this.getRoomActiveById(
        this.text.room.room203.id,
        this.text.room.room203.active,
        this.text.room.room203.student,
        this.text.room.room203.professor,
        this.text.room.room203.officer,
        "floor_2_203"
      );
      this.getRoomActiveById(
        this.text.room.room205.id,
        this.text.room.room205.active,
        this.text.room.room205.student,
        this.text.room.room205.professor,
        this.text.room.room205.officer,
        "floor_2_205"
      );
      this.getRoomActiveById(
        this.text.room.room207.id,
        this.text.room.room207.active,
        this.text.room.room207.student,
        this.text.room.room207.professor,
        this.text.room.room207.officer,
        "floor_2_207"
      );
      this.getRoomActiveById(
        this.text.room.room218.id,
        this.text.room.room218.active,
        this.text.room.room218.student,
        this.text.room.room218.professor,
        this.text.room.room218.officer,
        "floor_2_218"
      );
      this.getRoomActiveById(
        this.text.room.room219.id,
        this.text.room.room219.active,
        this.text.room.room219.student,
        this.text.room.room219.professor,
        this.text.room.room219.officer,
        "floor_2_219"
      );
      this.getRoomActiveById(
        this.text.room.room220.id,
        this.text.room.room220.active,
        this.text.room.room220.student,
        this.text.room.room220.professor,
        this.text.room.room220.officer,
        "floor_2_220"
      );
      this.getRoomActiveById(
        this.text.room.room221.id,
        this.text.room.room221.active,
        this.text.room.room221.student,
        this.text.room.room221.professor,
        this.text.room.room221.officer,
        "floor_2_221"
      );
      this.getRoomActiveById(
        this.text.room.room222.id,
        this.text.room.room222.active,
        this.text.room.room222.student,
        this.text.room.room222.professor,
        this.text.room.room222.officer,
        "floor_2_222"
      );
      this.getRoomActiveById(
        this.text.room.room223.id,
        this.text.room.room223.active,
        this.text.room.room223.student,
        this.text.room.room223.professor,
        this.text.room.room223.officer,
        "floor_2_223"
      );
      this.getRoomActiveById(
        this.text.room.room224.id,
        this.text.room.room224.active,
        this.text.room.room224.student,
        this.text.room.room224.professor,
        this.text.room.room224.officer,
        "floor_2_224"
      );
      this.getRoomActiveById(
        this.text.room.room225.id,
        this.text.room.room225.active,
        this.text.room.room225.student,
        this.text.room.room225.professor,
        this.text.room.room225.officer,
        "floor_2_225"
      );
      this.getRoomActiveById(
        this.text.room.room226.id,
        this.text.room.room226.active,
        this.text.room.room226.student,
        this.text.room.room226.professor,
        this.text.room.room226.officer,
        "floor_2_226"
      );
    },
    getBookingScheduleCurDateAndCurTime(roomId, rectId) {
      const path =
        "http://" +
        axiosConfig.APIGATEWAY.HOST +
        ":" +
        axiosConfig.APIGATEWAY.PORT +
        "/api/room/" + roomId + "/booking/time/now";

      axios
        .get(path)
        .then(res => {
          if (res.data[0] != null) {
            document.getElementById(rectId).setAttribute("fill", "red");
          } else if(res.data.message != null) {
            document.getElementById(rectId).setAttribute("fill", "#00ff00");
          }
        })
        .catch(error => {
          console.log(error)
        });
    }
  }
};
</script>

<style scoped>
rect:hover {
  cursor: pointer;
  stroke-width: 2;
  stroke: #01579b;
}

text:hover {
  cursor: pointer;
}
</style>